# Query Pipeline for {{ docstore_name|default('Docstore') }}
# Generated: {{ timestamp|default('') }}
# Index: {{ index_name }}
# Model: {{ embedder_model }}
# Top-K: {{ top_k }}

components:
  # Text embedder (same model as indexing)
  - name: embedder
    type: haystack.components.embedders.SentenceTransformersTextEmbedder
    init_parameters:
      model: {{ embedder_model }}
      normalize_embeddings: {{ normalize_embeddings|lower }}
      progress_bar: false
      device: cpu

  # Embedding retriever from OpenSearch
  - name: retriever
    type: haystack_integrations.components.retrievers.opensearch.OpenSearchEmbeddingRetriever
    init_parameters:
      document_store:
        type: haystack_integrations.document_stores.opensearch.OpenSearchDocumentStore
        init_parameters:
          hosts:
            - {{ opensearch_host }}
          index: {{ index_name }}
          embedding_dim: {{ embedding_dim|default(768) }}
          use_ssl: false
          verify_certs: false
      top_k: {{ top_k }}
      filters: null

# Pipeline connections
connections:
  - sender: embedder.embedding
    receiver: retriever.query_embedding
